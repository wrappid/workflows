name: Send Email - Deployed
on:
    workflow_call:
        inputs:
            tag-version:
                required: true
                type: string
jobs:
    send-email:
        name: Send Email
        runs-on: ubuntu-latest
        steps:

          - name: Sender Name configure
            id: sender-name
            run: |
              if [[ -n "${{ secrets.SENDER_NAME }}" ]]; then
                echo "SENDER_NAME=${{ secrets.SENDER_NAME }}" >> $GITHUB_ENV
              else
                REPOSITORY_OWNER_NAME=${{ github.repository_owner }}
                echo "SENDER_NAME=${REPOSITORY_OWNER_NAME^}" >> $GITHUB_ENV
              fi

## TODO: USE EMAIL TEMPLATES

          - name: 📧 Send mail
            uses: dawidd6/action-send-mail@v3
            with:
              server_address: smtp.gmail.com
              server_port: 465
              username: ${{secrets.MAIL_USERNAME}}
              password: ${{secrets.MAIL_PASSWORD}}
              secure: true
              from: $SENDER_NAME
              to: ${{secrets.IDS}}
              cc: ${{secrets.MAINTAINER_ID}}
              subject: Deployed - ${{ github.event.repository.name }} - ${{ inputs.tag-version }}. 🚀
              html_body: |
                <html lang="en">

                <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                </head>

                <body style="font-size: 1rem;"">
                  <p>Hi Testers 🕵🏽‍♂️,</p>
  
                  <p>Its time to hunt those bugs again 🐛<br>
                    We have deployed a new version of our ${{ github.event.repository.name }} project, ${{ steps.current-tag.outputs.tag }}. 🚀<br>
                    Start your hunt ${{ secrets.PROJECT_HOSTED_URL }}<br>
                    This version comes with some amazing new features and improvements that will make your experience even better.
                    You can check out the latest release details here https://github.com/${{ github.repository_owner }}/${{ github.event.repository.name }}/releases/tag/${{ inputs.tag-version }}.
                  </p>

                  <p>Thanks and Regards,<br>
                    $SENDER_NAME</p>
                    <footer style="font-size: 0.8rem; color: #ccc; height: 30px; line-height: 30px;">Generate by "${{ github.workflow }}" GitHub Action</footer>
                </body>
  
                </html>
              ignore_cert: true
              convert_markdown: true
              # attachments: attachments.zip,git.diff
              priority: normal

